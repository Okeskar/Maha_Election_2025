import os
import requests
from bs4 import BeautifulSoup

def download_file(url, filename, dst_folder):
    """Download a file and save it as filename in dst_folder."""
    os.makedirs(dst_folder, exist_ok=True)
    safe_name = filename.replace(" ", "_")  # replace spaces with underscores
    local_path = os.path.join(dst_folder, f"{safe_name}{os.path.splitext(url)[1]}")
    print(f"Downloading: {filename} → {local_path}")
    try:
        with requests.get(url, stream=True) as r:
            r.raise_for_status()
            with open(local_path, "wb") as f:
                for chunk in r.iter_content(chunk_size=8192):
                    if chunk:
                        f.write(chunk)
        print(f"✅ Saved: {local_path}")
    except Exception as e:
        print(f"❌ Failed: {url} ({e})")

def scrape_and_download(html_source, dst_folder):
    """Extract table info (name + link) and download each file."""
    soup = BeautifulSoup(html_source, "html.parser")

    rows = soup.find_all("tr")
    for row in rows[1:]:  # skip header row
        cols = row.find_all("td")
        if len(cols) >= 3:
            name = cols[1].get_text(strip=True)
            link_tag = cols[2].find("a", href=True)
            if link_tag:
                file_url = link_tag["href"]
                download_file(file_url, name, dst_folder)

if __name__ == "__main__":
    # Option 1 — fetch directly from the live website:
    # page_url = "https://pcmcparbhani.org/en/pcmc/election-2025"
    # html_content = requests.get(page_url).text

    # Option 2 — paste the HTML snippet directly here:
    html_content = """<tbody style="border-style: solid; border-width: 0px; vertical-align: inherit;"><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><span style="font-weight: bolder;">SR#</span></td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><span style="font-weight: bolder;">NAME</span></td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><span style="font-weight: bolder;">DOWNLOAD</span></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">1</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 01</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2001-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">2</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 02</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2002-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">3</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 03</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2003-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">4</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 04</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2004-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">5</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 05</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2005-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">6</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 06</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2006-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">7</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 07</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2007-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">8</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 08</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2008-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">9</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 09</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2009-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">10</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 10</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2010-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">11</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 11</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2011-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">12</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 12</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2012-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">13</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 13</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2013-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">14</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 14</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2014-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">15</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 15</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2015-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">16</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Ward 16</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagarpalika-Ward%2016-min.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr><tr style="border-style: solid; border-width: 1px 0px;"><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">17</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;">Mahanagarpalika Prabhag Rachna Map</td><td style="border-color: rgb(224, 224, 224); border-top-width: 0px; border-right-width: 1px; border-bottom-width: 0px; border-image: none 100% / 1 / 0 stretch; padding: 0.5rem; background-color: rgba(0, 0, 0, 0); background-image: none;"><a href="https://pcmcparbhani.org/upload/mahanagar%20palika%20prabhag%20rachna%20map.jpg" target="_blank" style="color: rgb(246, 140, 52); outline: 0px; transition: 0.4s;">Download</a></td></tr></tbody>"""

    # Folder to save downloaded files
    download_folder = r"C:\Onkar\Swapnil\Election maps\Parbhani"

    scrape_and_download(html_content, download_folder)
